<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#494f5c><meta name=msapplication-TileColor content=#494f5c><meta itemprop=name content="Python Tips and Gotchas"><meta itemprop=description content="This post is a work in progress and will expand over time.  
Replace literals with constants in if-expressions Whenever you need to check the value of a basic data type, the most straight-forward solution is to use literals:
1 2 3 4  if direction == 'up': # ... elif direction == 'down': # ...   This might seem like pythonic code, but its simplicity could bite you."><meta itemprop=datePublished content=2019-03-24T17:24:57&#43;01:00><meta itemprop=dateModified content=2019-03-24T17:24:57&#43;01:00><meta itemprop=wordCount content=1312><meta itemprop=keywords content=python,><meta property=og:title content="Python Tips and Gotchas"><meta property=og:description content="This post is a work in progress and will expand over time.  
Replace literals with constants in if-expressions Whenever you need to check the value of a basic data type, the most straight-forward solution is to use literals:
1 2 3 4  if direction == 'up': # ... elif direction == 'down': # ...   This might seem like pythonic code, but its simplicity could bite you."><meta property=og:type content=article><meta property=og:url content=https://andreasbergstrom.com/posts/python-gotchas-and-tips/><meta property=article:published_time content=2019-03-24T17:24:57&#43;01:00><meta property=article:modified_time content=2019-03-24T17:24:57&#43;01:00><meta name=twitter:card content=summary><meta name=twitter:title content="Python Tips and Gotchas"><meta name=twitter:description content="This post is a work in progress and will expand over time.  
Replace literals with constants in if-expressions Whenever you need to check the value of a basic data type, the most straight-forward solution is to use literals:
1 2 3 4  if direction == 'up': # ... elif direction == 'down': # ...   This might seem like pythonic code, but its simplicity could bite you."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Python Tips and Gotchas</title><link rel=stylesheet href=https://andreasbergstrom.com/css/style.min.c693329ce3bac2503f88115a4011a284a06d53e30f484562a37664dc4c5f0a74.css integrity="sha256-xpMynOO6wlA/iBFaQBGihKBtU+MPSEVio3Zk3ExfCnQ="><meta name=description content></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://andreasbergstrom.com/>Andreas Bergstr√∂m</a></div><nav class="site-nav hide-in-mobile"><a href=https://andreasbergstrom.com/posts/>Blog</a>
<a href=https://andreasbergstrom.com/tags/>Tags</a>
<a href=https://andreasbergstrom.com/about-me/>About me</a></nav></div><div class="hdr-right hdr-icons"><button id=toc-btn class="hdr-btn desktop-only-ib" title="Table of Contents"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><path d="M8 6H21z"/><path d="M8 12H21z"/><path d="M8 18H21z"/><path d="M3 6V6z"/><path d="M3 12v0z"/><path d="M3 18v0z"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/echoandreas target=_blank rel=noopener title=Twitter><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 0 1-3.14 1.53 4.48 4.48.0 0 0-7.86 3v1A10.66 10.66.0 0 1 3 4s-4 9 5 13a11.64 11.64.0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5.0 0 0-.08-.83A7.72 7.72.0 0 0 23 3z"/></svg></a><a href=https://instagram.com/andreas_erik_bergstrom target=_blank rel=noopener title=Instagram><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><path d="M17.5 6.5v0z"/></svg></a><a href=https://github.com/andreas-bergstrom target=_blank rel=noopener title=Github><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0 0 20 4.77 5.07 5.07.0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38.0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 0 0 5 4.77a5.44 5.44.0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 0 0 9 18.13V22"/></svg></a><a href=mailto:hi@andreasbergstrom.com target=_blank rel=noopener title=Email><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><path d="M22 6 12 13 2 6"/></svg></a><a href=https://linkedin.com/in/andreaserikbergstrom target=_blank rel=noopener title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><path d="M2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://stackoverflow.com/users/1202214/andreas-bergstr%c3%b6m target=_blank rel=noopener title=Stackoverflow><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852 10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056 9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785 8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751.0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749.0h.002z"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><path d="M3 12H21z"/><path d="M3 6H21z"/><path d="M3 18H21z"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://andreasbergstrom.com/posts/>Blog</a></li><li><a href=https://andreasbergstrom.com/tags/>Tags</a></li><li><a href=https://andreasbergstrom.com/about-me/>About me</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Mar 24, 2019</span></div><h1>Python Tips and Gotchas</h1></header><div class=content><hr><p><div style=text-align:center><strong>This post is a work in progress and will expand over time.</strong></div><hr></p><h2 id=replace-literals-with-constants-in-if-expressions>Replace literals with constants in if-expressions<a href=#replace-literals-with-constants-in-if-expressions class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><path d="M8 12h8z"/></svg></a></h2><p>Whenever you need to check the value of a basic data type, the most straight-forward solution is to use literals:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=k>if</span> <span class=n>direction</span> <span class=o>==</span> <span class=s1>&#39;up&#39;</span><span class=p>:</span>
  <span class=c1># ...</span>
<span class=k>elif</span> <span class=n>direction</span> <span class=o>==</span> <span class=s1>&#39;down&#39;</span><span class=p>:</span>
  <span class=c1># ...</span></code></pre></td></tr></table></div></div><p>This might seem like pythonic code, but its simplicity could bite you. If you have a lot of conditions and perhaps in multiple locations in your code, what happens if you mistype any of those string literals? Python will not complain, and there will not be any runtime errors. But you will end up with logical errors that could be insanely hard to track down.</p><p>Numeric literals are double trouble as the also comes with the issue of <a href=https://en.wikipedia.org/wiki/Magic_number_(programming)>magic numbers</a>. In the following example we not only have to guess what the number 545 really means, but it is almost easier to mistype than a string since we can not use common sense to detect a spelling error:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=k>if</span> <span class=n>error_code</span> <span class=o>==</span> <span class=mi>545</span><span class=p>:</span>
  <span class=c1># ...</span></code></pre></td></tr></table></div></div><p>In order to make your code more readable and to make it crash on any typos, using constants is often recommended. Simply extract the raw values into appropriately located constants (in Python just uppercased variables) and use the constants in the all if-expressions:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>UP</span> <span class=o>=</span> <span class=s1>&#39;up&#39;</span>
<span class=n>DOWN</span> <span class=o>=</span> <span class=s1>&#39;down&#39;</span>

<span class=k>if</span> <span class=n>direction</span> <span class=o>==</span> <span class=n>UP</span><span class=p>:</span>
  <span class=c1># ...</span></code></pre></td></tr></table></div></div><p>And with numeric literals:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>SERVER_DOWN</span> <span class=o>=</span> <span class=mi>100</span>
<span class=n>CONNECTION_ERROR</span> <span class=o>=</span> <span class=mi>200</span>

<span class=k>if</span> <span class=n>error_code</span> <span class=o>==</span> <span class=n>SERVER_DOWN</span><span class=p>:</span>
  <span class=c1># ...</span></code></pre></td></tr></table></div></div><p>In the first example Python will throw a NameError if you by mistake type &ldquo;UPP&rdquo;, &ldquo;uP&rdquo; or &ldquo;OP&rdquo;. Had we used string literals, Python would have had no way to recognize your typing error.</p><p>In larger projects you could group all constants in one or more modules. Since Python 3.4 there is also a new tool to help organize this: enums.</p><p>Enums are declared as classes but inherit from enum.Enum. This allows us to group related constants under a canonical name:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>enum</span>

<span class=k>class</span> <span class=nc>ErrorCode</span><span class=p>(</span><span class=n>enum</span><span class=o>.</span><span class=n>Enum</span><span class=p>):</span>
  <span class=n>SERVER_DOWN</span> <span class=o>=</span> <span class=mi>100</span>
  <span class=n>CONNECTION_ERROR</span> <span class=o>=</span> <span class=mi>200</span>

<span class=n>error</span> <span class=o>=</span> <span class=mi>100</span>

<span class=k>if</span> <span class=n>error</span> <span class=o>==</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=n>SERVER_DOWN</span><span class=o>.</span><span class=n>value</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=s1>&#39;Server is down&#39;</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Enums can be compared with the <strong><em>is</em></strong> keyword. If you are in control of how each operand in a comparison is created, you could therefor use enums throughout your code to increase the readability even futher:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>enum</span>

<span class=k>class</span> <span class=nc>ErrorCode</span><span class=p>(</span><span class=n>enum</span><span class=o>.</span><span class=n>Enum</span><span class=p>):</span>
  <span class=n>SERVER_DOWN</span> <span class=o>=</span> <span class=mi>100</span>
  <span class=n>CONNECTION_ERROR</span> <span class=o>=</span> <span class=mi>200</span>

<span class=n>error</span> <span class=o>=</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=n>CONNECTION_ERROR</span>

<span class=k>if</span> <span class=n>error</span> <span class=ow>is</span> <span class=n>ErrorCode</span><span class=o>.</span><span class=n>CONNECTION_ERROR</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=s1>&#39;There is a connetion error&#39;</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Do however keep in mind that <a href=https://stackoverflow.com/questions/30812793/how-to-use-python-3-4s-enums-without-significant-slowdown>enum attribute lookups are slower than regular attributes lookups</a>.</p><h2 id=microseconds-and-accuracy-in-time-sleep>Microseconds and accuracy in time.sleep()<a href=#microseconds-and-accuracy-in-time-sleep class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><path d="M8 12h8z"/></svg></a></h2><p>The sleep function in the time module can be used to halt execution for a given number of seconds. But it is easy to miss that the argument can be a float as well. In other words, you can use microseconds and not just whole seconds:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>time</span>
<span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.05</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>This can be useful when you need to make a short pause but not necesseraly in seconds. For example if you are hammering an internal or external API in some batch job it could be useful to let the other end catch its breath for a while by pausing for a few hundred microseconds.</p><p>Though you should not trust the accuracy of this function down to the microseconds, wether you are using seconds or microseconds. Since Python&rsquo;s sleep() uses the current operating system&rsquo;s underlying sleep-functionality, unless you are using a real-time system this function will not be 100% accurate:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>time</span>
<span class=kn>import</span> <span class=nn>timeit</span>

<span class=n>time</span> <span class=o>=</span> <span class=n>timeit</span><span class=o>.</span><span class=n>timeit</span><span class=p>(</span><span class=s1>&#39;time.sleep(0.05)&#39;</span><span class=p>,</span> <span class=n>number</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
<span class=k>print</span><span class=p>(</span><span class=n>time</span><span class=p>)</span>
<span class=n>time</span> <span class=o>=</span> <span class=n>timeit</span><span class=o>.</span><span class=n>timeit</span><span class=p>(</span><span class=s1>&#39;time.sleep(0.05)&#39;</span><span class=p>,</span> <span class=n>number</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
<span class=k>print</span><span class=p>(</span><span class=n>time</span><span class=p>)</span>
<span class=n>time</span> <span class=o>=</span> <span class=n>timeit</span><span class=o>.</span><span class=n>timeit</span><span class=p>(</span><span class=s1>&#39;time.sleep(0.05)&#39;</span><span class=p>,</span> <span class=n>number</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
<span class=k>print</span><span class=p>(</span><span class=n>time</span><span class=p>)</span></code></pre></td></tr></table></div></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=mf>5.273200581</span>
<span class=mf>5.261563578</span>
<span class=mf>5.282216143000001</span></code></pre></div><h2 id=master-date-and-time-handling-in-python>Master date and time handling in Python<a href=#master-date-and-time-handling-in-python class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><path d="M8 12h8z"/></svg></a></h2><p>It might seem like a basic advice, but you will be suprised how much time you can save by simply learning how to properly work with dates. While this is a common task it is often not practiced enough that you really remember all the ins and outs of it. But it is really simple!</p><p>When dealing with dates you will want to use the datetime packages, which comes with both date and datetime. The former is for working with dates and the latter for dates and time. There is also the less used time module. We will use datetime for the upcoming examples:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span></code></pre></td></tr></table></div></div><p>When working with dates you will also often use the timedelta module, which expresses the difference between two date, time or datetimes objects:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>timedelta</span></code></pre></td></tr></table></div></div><p>To get todays date as a datetime-object:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>18</span><span class=p>,</span> <span class=mi>610489</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>To create a datetime object you need to pass at least year, month and day:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=p>(</span><span class=n>year</span><span class=o>=</span><span class=mi>2019</span><span class=p>,</span> <span class=n>month</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>We can get the duration between two dates as a timedelta object by using subtraction:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=p>(</span><span class=n>year</span><span class=o>=</span><span class=mi>2019</span><span class=p>,</span> <span class=n>month</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>-</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>seconds</span><span class=o>=</span><span class=mi>47625</span><span class=p>,</span> <span class=n>microseconds</span><span class=o>=</span><span class=mi>375671</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Comparison can be used to determinate if a date is in the past or in the future:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=p>(</span><span class=n>year</span><span class=o>=</span><span class=mi>2019</span><span class=p>,</span> <span class=n>month</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span>
<span class=bp>True</span></code></pre></td></tr></table></div></div><p>By adding a timedelta to a datetime you get a new datetime:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=p>(</span><span class=n>year</span><span class=o>=</span><span class=mi>2019</span><span class=p>,</span> <span class=n>month</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>31</span><span class=p>)</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Subtracting a timedelta from another timedelta returns a new timedelta object:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>weeks</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>9</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Just as with objects of type datetime (and date and time) we can use comparison on timedeltas:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>6</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
<span class=bp>True</span></code></pre></td></tr></table></div></div><p>Every datetime object has a handful of attributes that allows you to easily get different parts of the date:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>year</span>
<span class=mi>2019</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>month</span>
<span class=mi>3</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>day</span>
<span class=mi>27</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>hour</span>
<span class=mi>11</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>minute</span>
<span class=mi>19</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>second</span>
<span class=mi>14</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>microsecond</span>
<span class=mi>346797</span></code></pre></td></tr></table></div></div><p>Since a datetime includes both the date and time, it can easily return either as a new date or time object:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>date</span><span class=p>()</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>date</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>time</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>409267</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Converting to and from timestamps:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>today</span><span class=p>()</span><span class=o>.</span><span class=n>timestamp</span><span class=p>()</span>
<span class=mf>1553686909.903327</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=mf>1553686909.903327</span><span class=p>)</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>903327</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Parsing a string into a date, time or datetime object:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=s1>&#39;2000-01-01&#39;</span><span class=p>,</span> <span class=s1>&#39;%Y-%m-</span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2000</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Formating a date, time or datetime object into a string:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%c</span><span class=s1>&#39;</span><span class=p>)</span>
<span class=s1>&#39;Wed Mar 27 1248 2019&#39;</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%A </span><span class=si>%-d</span><span class=s1> %B %Y&#39;</span><span class=p>)</span>
<span class=s1>&#39;Wednesday 27 March 2019&#39;</span></code></pre></td></tr></table></div></div><p>And finally a topic that sends chills down the spines of many programmers; timezones. The easiest way to handle those in Python is to use the 3rd party <a href=https://pypi.org/project/pytz/>pytz</a> package:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>pytz</span> <span class=kn>import</span> <span class=n>timezone</span></code></pre></td></tr></table></div></div><p>By default all datetimes in Python is said to be <strong><em>naive</em></strong>, meaning they lack any timezone information. The pytz package can make a datetime object <strong><em>aware</em></strong>, which its data will include the timezone:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>994510</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>tz</span> <span class=o>=</span> <span class=n>timezone</span><span class=p>(</span><span class=s1>&#39;Europe/Stockholm&#39;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>tz</span><span class=p>)</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>45471</span><span class=p>,</span> <span class=n>tzinfo</span><span class=o>=&lt;</span><span class=n>DstTzInfo</span> <span class=s1>&#39;Europe/Stockholm&#39;</span> <span class=n>CET</span><span class=o>+</span><span class=mi>100</span> <span class=n>STD</span><span class=o>&gt;</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>It is also possible to localize an existing datetime:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>tz</span><span class=o>.</span><span class=n>localize</span><span class=p>(</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2011</span><span class=p>,</span><span class=mi>11</span><span class=p>,</span><span class=mi>11</span><span class=p>))</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2011</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>tzinfo</span><span class=o>=&lt;</span><span class=n>DstTzInfo</span> <span class=s1>&#39;Europe/Stockholm&#39;</span> <span class=n>CET</span><span class=o>+</span><span class=mi>100</span> <span class=n>STD</span><span class=o>&gt;</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>Converting from one timezone to another is done through the astimezone() method. Notice the date and time does not change, only the timezone:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=n>dt_now</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>tz</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>dt_now</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>952962</span><span class=p>,</span> <span class=n>tzinfo</span><span class=o>=&lt;</span><span class=n>DstTzInfo</span> <span class=s1>&#39;Europe/Stockholm&#39;</span> <span class=n>CET</span><span class=o>+</span><span class=mi>100</span> <span class=n>STD</span><span class=o>&gt;</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>dt_now</span><span class=o>.</span><span class=n>astimezone</span><span class=p>(</span><span class=n>timezone</span><span class=p>(</span><span class=s1>&#39;US/Samoa&#39;</span><span class=p>))</span>
<span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2019</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=mi>952962</span><span class=p>,</span> <span class=n>tzinfo</span><span class=o>=&lt;</span><span class=n>DstTzInfo</span> <span class=s1>&#39;US/Samoa&#39;</span> <span class=n>SST</span><span class=o>-</span><span class=mi>1</span> <span class=n>day</span><span class=p>,</span> <span class=mi>1300</span> <span class=n>STD</span><span class=o>&gt;</span><span class=p>)</span></code></pre></td></tr></table></div></div><p>To view all available timezones use pytz.all_timezones:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>pytz</span> <span class=kn>import</span> <span class=n>all_timezones</span> 
<span class=o>&gt;&gt;&gt;</span> <span class=n>all_timezones</span>
<span class=p>[</span><span class=s1>&#39;Africa/Abidjan&#39;</span><span class=p>,</span> <span class=s1>&#39;Africa/Accra&#39;</span><span class=p>,</span> <span class=s1>&#39;Africa/Addis_Ababa&#39;</span><span class=o>...</span></code></pre></td></tr></table></div></div></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><path d="M7 7V7z"/></svg><span class=tag><a href=https://andreasbergstrom.com/tags/python>python</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2V8h6"/><path d="M16 13H8z"/><path d="M16 17H8z"/><path d="M10 9H9 8"/></svg>1312 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><path d="M16 2V6z"/><path d="M8 2V6z"/><path d="M3 10H21z"/></svg>2019-03-24 17:24 &#43;0100</p></footer></article><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><ul><li><a href=#replace-literals-with-constants-in-if-expressions>Replace literals with constants in if-expressions</a></li><li><a href=#microseconds-and-accuracy-in-time-sleep>Microseconds and accuracy in time.sleep()</a></li><li><a href=#master-date-and-time-handling-in-python>Master date and time handling in Python</a></li></ul></li></ul></nav></aside><div class="post-nav thin"><a class=prev-post href=https://andreasbergstrom.com/posts/python-random-name-generator/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><path d="M5 12H19z"/><path d="M12 5l7 7-7 7"/></svg></span><br><span>Python random name generator</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2019 <a href=https://andreasbergstrom.com/>Andreas Bergstr√∂m</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://andreasbergstrom.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://andreasbergstrom.com/js/main.min.8f39f24808e9d0a9b02da58c2d2838da859dc0b7bdfadbdb1883aae8b6adacfe.js integrity="sha256-jznySAjp0KmwLaWMLSg42oWdwLe9+tvbGIOq6LatrP4="></script><script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push(100897614);</script><script async src=//static.getclicky.com/js></script></body></html>