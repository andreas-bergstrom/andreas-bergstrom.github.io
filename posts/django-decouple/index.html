<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Django Environment Variables with Decouple - Andreas Bergström</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property=og:title content="Django Environment Variables with Decouple"><meta property=og:description content="An application&rsquo;s configuration might seem like a no-brainer at first. It is just a bunch of variables that can be put in a regular code file, right? And if our local and production environments require different settings let us just throw in some if-statements, if it becomes cumbersome we can always pass some good old command line arguments when launching it. Wait did we just commit our secret key and Mailgun-credentials to source control?"><meta property=og:type content=article><meta property=og:url content=https://andreasbergstrom.com/posts/django-decouple/><meta property=article:published_time content=2019-07-12T06:31:39&#43;01:00><meta property=article:modified_time content=2019-07-12T06:31:39&#43;01:00><meta name=twitter:card content=summary><meta name=twitter:title content="Django Environment Variables with Decouple"><meta name=twitter:description content="An application&rsquo;s configuration might seem like a no-brainer at first. It is just a bunch of variables that can be put in a regular code file, right? And if our local and production environments require different settings let us just throw in some if-statements, if it becomes cumbersome we can always pass some good old command line arguments when launching it. Wait did we just commit our secret key and Mailgun-credentials to source control?"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:500,100,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=/js/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title>Andreas Bergström</h1><div class=site-description><h2>Full Stack Web Developer</h2><nav class="nav social"><ul class=flat><a href=https://github.com/andreas-bergstrom title=Github><i data-feather=github></i></a><a href=https://www.linkedin.com/in/andreaserikbergstrom/ title=LinkedIn><i data-feather=linkedin></i></a><a href=https://stackoverflow.com/users/1202214/andreas-bergstr%c3%b6m title="Stack Overflow"><i data-feather=paperclip></i></a><a href=https://twitter.com/echoandreas title=Twitter><i data-feather=twitter></i></a><a href=mailto:hi@andreasbergstrom.com title="Send email"><i data-feather=mail></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/about-me>About</a></li><li><a href=/tags>Tags</a></li></ul></nav></div><div class=post-header><h1 class=title>Django Environment Variables with Decouple</h1><div class=meta>Posted at &mdash; Jul 12, 2019</div></div><div class=markdown><p>An application&rsquo;s configuration might seem like a no-brainer at first. It is just a bunch of variables that can be put in a regular code file, right? And if our local and production environments require different settings let us just throw in some if-statements, if it becomes cumbersome we can always pass some good old command line arguments when launching it. Wait did we just commit our secret key and Mailgun-credentials to source control? Crap.</p><p>There are many reasons to why using a single configuration file is problematic, even in small projects where you are the only developer. And using time constraints as a justification for not paying attention to this at the beginning of every projects will not hold up, as it only takes a few seconds to get it right.</p><p>Depending on your taste, environment and corporate policies (poor you) there a few different alternatives at hand.</p><h2 id=multiple-configuration-files>Multiple configuration files</h2><p>Django has built-in support for loading specific settings when launching. This can be utilized to modularize your settings. First it&rsquo;s good practice and DRY to put shared settings into a base settings file:</p><p>base.py<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>INSTALLED_APPS = [...]

MIDDLEWARE = [...]

ROOT_URLCONF = <span style=color:#a31515>&#39;&#39;</span>

WSGI_APPLICATION = <span style=color:#a31515>&#39;&#39;</span></code></pre></td></tr></table></div></div></p><p>Then for the development settings, a solid foundation would be to enable the debug mode and display the debug toolbar. We might also want to use the console email backend or some specific credentials if using a 3rd party provider like Mailgun or Sendgrid.</p><p>development.py<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#00f>from</span> .base <span style=color:#00f>import</span> *

DEBUG = True

MIDDLEWARE += [<span style=color:#a31515>&#39;debug_toolbar.middleware.DebugToolbarMiddleware&#39;</span>, ]

EMAIL_BACKEND = <span style=color:#a31515>&#39;django.core.mail.backends.console.EmailBackend&#39;</span></code></pre></td></tr></table></div></div></p><p>For the production settings, we would at least disable debug mode and enable a cache of some kind. And also use a real backend for email.</p><p>production.py<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#00f>from</span> .base <span style=color:#00f>import</span> *

DEBUG = False

CACHES = {...}

EMAIL_BACKEND = <span style=color:#a31515>&#39;django.core.mail.backends.smtp.EmailBackend&#39;</span></code></pre></td></tr></table></div></div></p><p>Notice how both development.py and production.py imports all settings from base.py. While using import * is in most cases an anti-pattern, this is one of the rare exceptions.</p><p>The settings flag is used to tell Django that it should look elsewhere than the default path for settings:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python manage.py runserver --settings=mysite.settings.development</code></pre></div><p>and don&rsquo;t forget migrations:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python manage.py migrate --settings=mysite.settings.development</code></pre></div><p>While this gives your more better organized settings with less repetition and no horrible if-statements, it is not perfect. Any sensitive credentials like secret keys or credentials for 3rd party services would still end up in your source control and in the hands of every person that can access it.</p><h2 id=environment-variables-and-the-os-module>Environment variables and the os module</h2><ul><li>easy to alter without requiring code changes and releases</li><li><p>import os, os.environ</p></li><li><p>KeyError: os.environ[&ldquo;]</p></li><li><p>None: os.environ.get(&lsquo;KEY_THAT_MIGHT_EXIST&rsquo;)</p></li><li><p>default value: os.getenv(&lsquo;KEY_THAT_MIGHT_EXIST&rsquo;, default_value)</p></li></ul><h2 id=environemnt-variables-through-decouple>Environemnt variables through Decouple</h2><ul><li><a href=https://github.com/henriquebastos/python-decouple>https://github.com/henriquebastos/python-decouple</a></li><li>pip install python-decouple</li><li>.env + .gitignore</li><li>from decouple import config</li><li>config(&lsquo;DEBUG&rsquo;, default=False, cast=bool)</li></ul></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='andreasbergstromcom';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class="footer wrapper"><nav class=nav><div><a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>